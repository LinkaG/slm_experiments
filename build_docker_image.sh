#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

set -e

IMAGE_NAME="slm-experiments"
IMAGE_TAG="latest"

echo "üî® –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ $IMAGE_NAME:$IMAGE_TAG..."
echo "üì¶ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ PyTorch —Å CUDA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π"
echo "üí° –û–±—Ä–∞–∑ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) –∏ CPU (fallback)"
echo "‚è±Ô∏è  –≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ"
echo ""

# –ò—Å–ø–æ–ª—å–∑—É–µ–º --no-cache –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ (–≤–∞–∂–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫)
docker build --no-cache -f Dockerfile.experiments -t "$IMAGE_NAME:$IMAGE_TAG" .

echo ""
echo "‚úÖ –û–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üí° –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–ø—Ç:"
echo "   ./run_experiment_fast.sh run_experiment_simple.py"

